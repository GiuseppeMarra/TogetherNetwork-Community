<!DOCTYPE html>
<html>
	<head>
		<title>Together Network</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Custom Fonts -->

		<link href='http://fonts.googleapis.com/css?family=Actor' rel='stylesheet' type='text/css'>

		<!-- Bootstrap CSS -->

		<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="/static/css/style.css" rel="stylesheet" media="screen">

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	    <![endif]-->
		{% block head %}{% endblock %}
	</head>
	<body>
        <div id="fb-root"></div>
		{% block header %}
		<nav id="mainNavBar" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"><img src="/static/imgs/logos/logo-Together-small.png"></a>
			</div>
		
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				{% block main_menu %}
				<ul class="nav navbar-nav">
					<li class="dropdown">
				        <a href="/about" class="dropdown-toggle" data-toggle="dropdown">What is Together<b class="caret"></b></a>
				        <ul class="dropdown-menu">
				          <li><a class="active" href="/about">About</a></li>
				          <li><a href="/manifesto">Manifesto</a></li>
				          <li><a href="/principles">Principles</a></li>
				          <li><a href="/where">The House</a></li>
				        </ul>
				    </li>
			        <li class="divider"></li>
			        {% block extend_main_menu %}
      				<li><a href="/users/community">Community</a></li>
					<li><a href="/activities/list">Activities</a></li>
					<li><a href="/accommodations/list">Accomodations</a></li>
					{% endblock %}
				</ul>
				{% endblock %}
				
				{% block user_menu %}
				<ul class="nav navbar-nav navbar-right">
 					<li class="dropdown">
 						{% if request.user.is_authenticated %}
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span><b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="/users/edit">Account settings</a></li>
							<li><a href="/avatar/change">Change Avatar</a></li>
							<li><a href="/users/{{ request.user.username }}/">My profile</a></li>
							<li><a href="/accounts/logout/?next=/">Log out</a></li>
						</ul>
						{% endif %}
					</li>
				</ul>
 				{% if not request.user.is_authenticated %}
 				<div class="pull-right">
					<a href="/accounts/login/{% if not '/accounts/login' in request.get_full_path %}?next={{ request.get_full_path }}{% endif %}" class="signin-btn navbar-btn btn btn-sm btn-default">Sign In</a>
					<a href="/accounts/register/" class="signin-btn navbar-btn btn btn-sm btn-default">Sign Up</a>
				</div>
				{% endif %}
				{% endblock %}
				{% block navbar_buttons %}{% endblock %}		
			</div><!-- /.navbar-collapse -->
		</nav>
		{% endblock %}

		{% if messages %}
		<div class="container" id="messagesContainer">
            <!-- Messages -->
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-info{% endif %}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}

		{% block container %}
	    <div class="container" id="mainContainer">
		    {% block content %}{% endblock %}
	    </div>
	    {% endblock %}

		<!-- footer -->
		{% block footer %}
		{% endblock %}

		<!-- jQuery -->
		<script src="//code.jquery.com/jquery.js"></script>
		<!-- Bootstrap JavaScript -->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
		<!-- Fix margin-top -->
        <script type="text/javascript">
            $(function() {
            	{% if messages %}
                $("#messagesContainer").css("margin-top", $("#mainNavBar").height() + 10 );   
                $(window).resize(function() { 
                    $("#messagesContainer").css("margin-top", $("#mainNavBar").height() + 10 );
                });
                {% else %}
                $("#mainContainer").css("margin-top", $("#mainNavBar").height() );   
                $(window).resize(function() { 
                    $("#mainContainer").css("margin-top", $("#mainNavBar").height() );
                });
                {% endif %}
            })
        </script>
        <!-- Facebook Stuff -->
        <script type="text/javascript">
            window.fbAsyncInit = function() {
                // init the FB JS SDK
                FB.init({
                  appId      : '605827832822869',                    // App ID from the app dashboard
                  status     : true,                                 // Check Facebook Login status
                  xfbml      : true                                  // Look for social plugins on the page
                });

                // Additional initialization code such as adding Event Listeners goes here
            };

            // Here we subscribe to the auth.authResponseChange JavaScript event. This event is fired
            // for any authentication related change, such as login, logout or session refresh. This means that
            // whenever someone who was previously logged out tries to log in again, the correct case below 
            // will be handled. 
            FB.Event.subscribe('auth.authResponseChange', function(response) {
                // Here we specify what we do with the response anytime this event occurs. 
                if (response.status === 'connected') {
                    // The response object is returned with a status field that lets the app know the current
                    // login status of the person. In this case, we're handling the situation where they 
                    // have logged in to the app.
                    testAPI();
                } else if (response.status === 'not_authorized') {
                    // In this case, the person is logged into Facebook, but not into the app, so we call
                    // FB.login() to prompt them to do so. 
                    // In real-life usage, you wouldn't want to immediately prompt someone to login 
                    // like this, for two reasons:
                    // (1) JavaScript created popup windows are blocked by most browsers unless they 
                    // result from direct interaction from people using the app (such as a mouse click)
                    // (2) it is a bad experience to be continually prompted to login upon page load.
                    FB.login();
                } else {
                    // In this case, the person is not logged into Facebook, so we call the login() 
                    // function to prompt them to do so. Note that at this stage there is no indication
                    // of whether they are logged into the app. If they aren't then they'll see the Login
                    // dialog right after they log in to Facebook. 
                    // The same caveats as above apply to the FB.login() call here.
                    FB.login();
                }
            });
            // Load the SDK asynchronously
            $(function(){
                 // If we've already installed the SDK, we're done
                 if (document.getElementById('facebook-jssdk')) {return;}

                 // Get the first script element, which we'll use to find the parent node
                 var firstScriptElement = document.getElementsByTagName('script')[0];

                 // Create a new script element and set its id
                 var facebookJS = document.createElement('script'); 
                 facebookJS.id = 'facebook-jssdk';

                 // Set the new script's source to the source of the Facebook JS SDK
                 facebookJS.src = '//connect.facebook.net/en_US/all.js';

                 // Insert the Facebook JS SDK into the DOM
                 firstScriptElement.parentNode.insertBefore(facebookJS, firstScriptElement);
            }());
            </script>
		<!-- Custom JavaScript scripts -->
        {% block scripts %}{% endblock %}
	</body>
</html>